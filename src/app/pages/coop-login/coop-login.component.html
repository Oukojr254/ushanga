<div *ngIf="auth.user$ | async; then authenticated else guest">
    <!-- template will replace this div -->
</div>

<!-- User NOT logged in -->
<ng-template #guest>
    <div class="container-fluid" style="background-color: rgb(210, 183, 4); padding:0.35%">
    </div>
    <app-nav></app-nav>
    <div class="container-fluid" style="height: 50vh; 
      background-image: url('./../../../assets/U20-120.jpg');
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover; 
    ">

    </div>
    <div class="container" style="padding: 6%">
        <div class="row">
            <div class="col-sm-5" >
                <div class="vertcent" >
                    <h3 class="title">Hi! Welcome to Ushanga</h3>
                    <p style="letter-spacing: 1px;" >Login to get started...</p>

                    <a class="btn btn-signin btn-block shadow-0 ripple-surface" (click)="auth.googleSignin()">
                        <span  class="subtitle">
                            <img src="./../../../assets/Google__G__Logo.svg" alt=""> 
                            &nbsp; 
                            <small class="tabtitle" style="font-size: 12px!important;color: black;">Log in with Google</small>
                        </span>
                    </a> 
                </div>
            </div>
            <div class="col-sm-7"> 
                <div class=" ">
                    <p ><small style="letter-spacing: 1px;"> "Lorem ipsum dolor sit, amet consectetur adipisicing elit. Laudantium, est quisquam similique nesciunt 
                        temporibus perspiciatis minima officiis, obcaecati alias sunt ipsa fugiat quae deleniti reiciendis laboriosam veritatis.
                         Voluptate, doloremque architecto!"</small></p>
                    <!-- <h3 class="subtitle" style="font-weight: bold; color:var(--dark)">Ushanga Kenya</h3> -->
                    <div style="margin-top: 8%;">
                        <p class="tabtitle" style="font-size: 12px!important;margin-bottom: 0%;">
                            <small style="color: var(--medium);">Connect with us</small>                            
                        </p>
                                                    
                        <!-- Section: Social media -->
                        <section  >
                            <!-- Facebook -->
                            <a
                            class="btn btn-link btn-floating btn-lg text-dark m-1"
                            href="#!"
                            role="button"
                            data-mdb-ripple-color="dark"
                            ><i class="fab fa-facebook-f"></i
                            ></a>
                    
                            <!-- Twitter -->
                            <a
                            class="btn btn-link btn-floating btn-lg text-dark m-1"
                            href="#!"
                            role="button"
                            data-mdb-ripple-color="dark"
                            ><i class="fab fa-twitter"></i
                            ></a>
                    
                            <!-- Google -->
                            <a
                            class="btn btn-link btn-floating btn-lg text-dark m-1"
                            href="#!"
                            role="button"
                            data-mdb-ripple-color="dark"
                            ><i class="fab fa-google"></i
                            ></a>
                    
                            <!-- Instagram -->
                            <a
                            class="btn btn-link btn-floating btn-lg text-dark m-1"
                            href="#!"
                            role="button"
                            data-mdb-ripple-color="dark"
                            ><i class="fab fa-instagram"></i
                            ></a>
            
                            <!-- Instagram -->
                            <a
                            class="btn btn-link btn-floating btn-lg text-dark m-1"
                            href="#!"
                            role="button"
                            data-mdb-ripple-color="dark"
                            ><i class="fab fa-solid fa-location-dot"></i
                            ></a>
                        
                        </section>
                        <!-- Section: Social media -->
                    </div>
                </div>
            </div> 
        </div>
    </div>
</ng-template>

<!-- User logged in -->
<ng-template #authenticated>
    <div *ngIf="auth.user$ | async as user">
        <div *ngIf='user.coop'>
            <app-nav></app-nav>  
            <div class="app-header">
                <div class="app-header-left">
                    
                </div>
                <div class="app-header-right">
                
                <a 
                class="btn btn-link text-dark js-toggle-cart" 
                role="button" 
                >
                    <div style="position: relative;
                    display:inline-block; ">
                        <span class="badge notify-badge">3</span>
                        <img class="cartsvg" src="./../../../../assets/shopping-bag-svgrepo-com.svg" data-count="2" style="height: 25px; width:25px" alt="">   
                    </div>
                </a>
                <button class="profile-btn">
                    
                    <img *ngIf="!user.photoURL" src="https://assets.codepen.io/3306515/IMG_2025.jpg" />
    
                    <img *ngIf="user.photoURL" [src]="user.photoURL">
                    
                    <span>{{ user.displayName }}</span>
                </button>
                
                <button class="btn btn-custom shadow-0" (click)="auth.signOut()">Logout</button>
                </div>
                <button class="messages-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-circle">
                    <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" /></svg>
                </button>
            </div>
            <div class="row" style="height: auto;">
                <div class="col-sm-1"></div>
                <div class="col-sm-6">
                    <div class="projects-section">
                        <div class="projects-section-header">
                            <p>Products in catalogue</p>
                            <button  data-mdb-toggle="modal" data-mdb-target="#productModal" routerLinkActive="router-link-active"   type="button" class="btn btn-link btn-sm btn-rounded">
                              <small style="text-transform: capitalize;" >Add new</small>
                            </button>
                        </div>
                        <div style="display: flex; justify-content: space-around">
                          <input type="text" class="searchbox" placeholder="Type to search"> 
                        </div> 
                        <table style='margin-top:4%' class="table align-middle mb-0 bg-white">
                             
                            <tbody>
                              <tr *ngFor="let item of products" >
                                <td>
                                  <div class="d-flex align-items-center">
                                    <img
                                        [src]="item.imageURL"
                                        alt=""
                                        class="prod-im" 
                                        />
                                    <div class="ms-3">
                                      <p class="fw-bold mb-1"> {{item.name}} </p>
                                      <p class="text-muted mb-0">
                                         <small>{{item.id}}</small>   
                                      </p>
                                    </div>
                                  </div>
                                </td>
                                <td>
                                  <p class="fw-normal mb-1">{{item.owner }}  </p>
                                  <p style=" letter-spacing: 1px;font-size: 12px; color: grey;">{{item.location}}</p>
                                </td>
                                <td>
                                  <span *ngIf="item.status == 1" style='color: green; border-radius:5px; padding:8%; background-color:lightgreen;'><small style="letter-spacing: 1px; font-size: 10px;">Active</small></span>
                                  <span *ngIf="item.status == 0" style='color: blue; border-radius:5px; padding:8%; background-color:lightblue;'><small style="letter-spacing: 1px; font-size: 10px; " >Sold</small></span>
                                  <br>

                                  <span class="text-muted mb-0" style="margin-top: 4%;">
                                    <small>{{item.price  | currency : 'KES '}}</small>   
                                  </span>
                                </td>
                                <td>
                                  <button (click)="setValues(item)"  data-mdb-toggle="modal" data-mdb-target="#productEditModal" routerLinkActive="router-link-active"   type="button" class="btn btn-link btn-sm btn-rounded">
                                    <small style="text-transform: capitalize;">Edit</small>
                                  </button>
                                </td> 
                              </tr> 
                            </tbody>
                        </table>
                    </div>   
                </div>
                <div class="col-sm-4">
                  <div class="projects-section" style='padding-right:0%'>
                    <div class="projects-section-header">
                        <p>Registered Users</p> 
                        
                    </div>
                    <div style="display: flex; justify-content: space-around">
                      <input type="text" class="searchbox" placeholder="Type to search"> 
                    </div> 
                    <table style="margin-top: 4%;" class="table align-middle mb-0 bg-white">
                        <tbody>
                          <tr *ngFor="let item of cooperativeMembers" >
                            <td style="padding: 0%">
                              <div class="d-flex align-items-center">
                                <div class="ms-3">
                                  <p class="fw-bold  ">{{item.number  | phone}} <br><small class="text-muted">{{item.name}}</small> </p>
                                  
                                </div>
                              </div>
                            </td>
                            <td>
                              <!-- <p class="fw-normal mb-1">+254 (712) - 345 - 678</p> -->
                              <p style=" letter-spacing: 1px;font-size: 12px; color: grey;">{{item.location}}, {{item.county}}</p>

                            </td> 
                            <td>
                              
                              <button type="button" class="btn btn-link btn-sm btn-rounded">
                                Edit
                              </button>
                            </td> 
                          </tr>
                         
                        </tbody>
                    </table>
                </div>   
                </div>
            </div> 
            <div class="row" style="margin-top: 5%">
              <div class="col-sm-1"></div>
              <div class="col-sm-10">
                <div class="projects-section-header">
                  <p>Transaction history</p>
                   
                </div>
                
                <div style="display: flex; justify-content: space-around">
                  <input type="text" class="searchbox" placeholder="Type to search"> 
                </div>  
                <table class="table align-middle mb-0 bg-white" style="margin-top: 4%;">
                  
                  <tbody>
                    <tr *ngFor="let item of products" >
                      <td>
                        <div class="d-flex align-items-center">
                          <img
                              [src]='item.imageURL'
                              alt=""
                              class="prod-im" 
                              />
                          <div class="ms-3">
                            <p class="fw-bold mb-1">{{item.name}}</p>
                            <p class="text-muted mb-0">{{item.id}}</p>
                          </div>
                        </div>
                      </td>
                      <td>
                        <p class="fw-normal mb-1">+254 (712) - 345 - 678</p>
                        <p style=" letter-spacing: 1px;font-size: 12px; color: grey;">Lomut, West Pokot</p>
                      </td>
                      <td>
 
                          <span *ngIf="item.status == 1" style='color: green; border-radius:5px; padding:8%; background-color:lightgreen;'><small style="letter-spacing: 1px; font-size: 10px;">Active</small></span>
                          <span *ngIf="item.status == 0" style='color: blue; border-radius:5px; padding:8%; background-color:lightblue;'><small style="letter-spacing: 1px; font-size: 10px; " >Sold</small></span>
                          <p class="text-muted mb-0" style="margin-top: 4%">Kes. 1,235</p>

                      </td>
                      <td>
                        <p>Sold on 29 Aug, 2022 <br> <small class="text-muted">11.29 pm</small> </p> 
                      </td>  
                      <td>
                        <p>M-pesa transaction <br>
                          <small class="text-muted">Paybill No 1234556</small>
                        </p>
                      </td>
                      <td>
                        <p><small>Received by <span style='color: darkgoldenrod; border-radius:5px; padding:4%; background-color:lightyellow;'><small>Ushanga HQ</small></span></small></p>
                      </td>
                      <!-- <td>
                        
                        <button type="button" class="btn btn-link btn-sm btn-rounded">
                          Edit
                        </button>
                      </td>  -->
                    </tr> 
                  </tbody>
                </table>
              </div>
              <div class="col-sm-1"></div>
            </div>
        </div>
        <div *ngIf='!user.coop'>
            Not coop
        </div>
        

    </div>
</ng-template>

<app-cart></app-cart>

<!-- Modal -->
<div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Create new product</h5>
        <button type="button" class="btn-close" data-mdb-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="submit-form"> 
          <form *ngIf="!submitted" [formGroup]="form" (ngSubmit)="onSubmit()">
            <div style="display: inline;" *ngIf="editImg">
              <img [src]="editImg" class="prod-im">
            </div>
            <div class=" ">
              <input type="file"
              id="file"
              #userPhoto
              (change)="onFileSelected($event)"
              name="image"
              autocomplete="off"
              />
              
              <div class="progress" style="margin-top: 4%;" *ngIf="uploadProgress$ | async as progress">
                <div class="progress-bar progress-bar-animated" [ngStyle]="{ 'width': progress + '%' }"></div>
              </div>
             </div>
             
            <div class="form-outline">
              <input type="text" name="name" formControlName="name" id="name" class="form-control form-control-sm" required/>
              <label class="form-label" for="formControlSm"> 
                <small>Product Name</small>
                 <span class="text-danger" *ngIf="form.get('name')?.errors &&form.get('name')?.hasError('required')">*</span>
               </label>
            </div>
            
            <div class="form-outline">
              <input type="number" name="price" formControlName="price" id="price" class="form-control form-control-sm" required/>
              <label class="form-label" for="formControlSm"> <small>Price</small>
                 <span class="text-danger" *ngIf="form.get('price')?.errors &&form.get('price')?.hasError('required')">*</span>

             </label>
            </div> 
            <div class="form-outline">
              <input type="text" name="location" formControlName="location" id="location" class="form-control form-control-sm" required/>
              <label class="form-label" for="formControlSm"> <small>Location</small>
                 <span class="text-danger" *ngIf="form.get('location')?.errors &&form.get('location')?.hasError('required')">*</span>
              </label>
            </div> 
            <div class="form-outline">
              <label class="form-label" for="formControlSm"> <small>Member</small>
                 <span class="text-danger" *ngIf="form.get('owner')?.errors &&form.get('owner')?.hasError('required')">*</span>
              </label>
              <select class="form-select form-select-sm" formControlName="owner"  aria-label="Default select example"> 
                <option *ngFor="let item of cooperativeMembers" [value]="item.id" selected> {{item.name}} - {{item.number | phone }}</option> 
              </select> 
            </div> 
            <div *ngIf="!submitted" class="modal-footer">
              <button type="button" class="btn btn-secondary btn-sm" data-mdb-dismiss="modal">Close</button>
              <button type="button" type="submit" class="btn btn-primary btn-sm">Submit</button>
            </div>
          </form>
          <div *ngIf="submitted">
            <h4>You submitted successfully!</h4>
            <button class="btn btn-success" (click)="newProduct()">Add new product</button>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="productEditModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Edit product</h5>
        <button type="button" class="btn-close" data-mdb-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="submit-form"> 
          <form *ngIf="!submitted" [formGroup]="formEdit" (ngSubmit)="onSubmitEdit()">
            <div style="display: inline;" *ngIf="editImg">
              <img [src]="editImg" class="prod-im">
            </div>
            <div class=""  style="margin-top: 4%;">
              <input type="file"
              id="file"
              #userPhoto
              (change)="onFileSelected($event)"
              name="image"
              autocomplete="off"
              />
              <div class="progress" style="margin-top: 4%;" *ngIf="uploadProgress$ | async as progress">
                <div class="progress-bar progress-bar-animated" [ngStyle]="{ 'width': progress + '%' }"></div>
              </div>
            </div>
             
            <div class="form" style="margin-top: 4%;">
              <label class="form-label" for="formControlSm"> 
                <small>Product Name</small>
                <span class="text-danger" *ngIf="formEdit.get('name')?.errors &&formEdit.get('name')?.hasError('required')">*</span>
              </label>
              <input type="text" name="name" formControlName="name" id="name" class="form-control form-control-sm" required/>
            </div>
            
            <div class="form">
              <label class="form-label" for="formControlSm"> <small>Price</small>
                <span class="text-danger" *ngIf="formEdit.get('price')?.errors &&formEdit.get('price')?.hasError('required')">*</span>
             </label>
              <input type="number" name="price" formControlName="price" id="price" class="form-control form-control-sm" required/>
            </div> 
            <div class="form">
              <label class="form-label" for="formControlSm"> <small>Location</small>
                <span class="text-danger" *ngIf="formEdit.get('location')?.errors &&formEdit.get('location')?.hasError('required')">*</span>
             </label>
              <input type="text" name="location" formControlName="location" id="location" class="form-control form-control-sm" required/>

            </div> 
            <div class="form-outline">
              <label class="form-label" for="formControlSm"> <small>Member</small>
                 <span class="text-danger" *ngIf="formEdit.get('owner')?.errors &&formEdit.get('owner')?.hasError('required')">*</span>
              </label>
              <select class="form-select form-select-sm" formControlName="owner"  aria-label="Default select example"> 
                <option *ngFor="let item of cooperativeMembers" [value]="item.id" selected > {{item.name}} - {{item.number | phone }}</option> 
              </select> 
            </div> 
            <div *ngIf="!submitted" class="modal-footer">
              <button type="button" class="btn btn-secondary btn-sm" data-mdb-dismiss="modal">Close</button>
              <button [disabled]="formEdit.invalid" type="button" type="submit" class="btn btn-primary btn-sm">Edit</button>
            </div>
          </form>
          <div *ngIf="submitted">
            <h4>You submitted successfully!</h4> 
          </div>

        </div>
      </div>
    </div>
  </div>
</div>